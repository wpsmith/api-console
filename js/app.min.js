jQuery(document).ready(function(e){e.ajax({url:"config.json"}).done(function(t){var a=e("#requests"),n=e.cookie("panelWidth"),s=e("#panel"),i=e(".inputs"),d=!1,r=!1,o=null,l=function(e){var t=5,a=s.width(),n=a,i=a+t;o!=e.pageX&&(o=e.pageX,o>n&&i>o?(r=!0,document.body.style.cursor="ew-resize !important"):(r=!1,document.body.style.cursor=null))},u=function(e){var t=220,n=window.innerWidth-400,i=Math.max(Math.min(n,e.pageX),t);e.preventDefault(),s.width(i),a.css({left:i})},p=e("<span/>"),c=function(e){return p.text(e).html()};s.width(n),a.css({left:n+"px"}),e(window).bind("resize",function(){var t=220,n=window.innerWidth-400,i=Math.max(Math.min(n,s.width()),t);s.width(i),a.css({left:i}),e.cookie("panelWidth",s.width())}).trigger("resize"),e(document).bind("mousemove",l),e(document).bind("mousedown",function(t){r&&(t.preventDefault(),d=!0,e(document).unbind("mousemove",l).bind("mousemove",u))}),e(document).bind("mouseup",function(){d&&(d=!1,e.cookie("panelWidth",s.width()),e(document).unbind("mousemove",u).bind("mousemove",l))}),e("ul#requests").click(function(t){var a=e(t.target),n=a.is("h2")?a:a.parents("h2");n.is("h2")&&($li=n.parents("li"),$li[$li.hasClass("expanded")?"removeClass":"addClass"]("expanded"))});var h=function(t){return t.find("ul.object, ul.array").each(function(){var t=e(this),a=t.parent(),n=e("<a>&#x25B8;</a>").addClass("disclosure").click(function(){a[a.hasClass("closed")?"removeClass":"addClass"]("closed")});a.addClass("closed").append(n)}),t},f=function(e,t){return JSON.stringify(e,null,t)},g=function(n,s){var i,d;if(s||(s=[]),n&&(n.constructor!=Array||0!=n.length)){if("object"==typeof n){i=e("<ul></ul>").addClass("object");for(field in n)d=e("<li>"),d.append(e("<span></span>").addClass("key").text(field)).append(" "),n&&n[field]&&("array"==typeof n[field]||Array==n[field].constructor)?d.append(e("<span></span>").text("Array["+n[field].length+"]").addClass("hint")):"object"==typeof n[field]&&d.append(e("<span></span>").text("Object").addClass("hint")),d.append(g(n[field],s.concat([field]))),i.append(d)}else{if(void 0===n)return e("<span>undefined</span>");var r,o=n.toString();i=e("<span>").addClass("value").addClass(typeof n).text(o),(r=o.match("^"+t.api_url+"(/.*)"))?i.click(function(){e("form").trigger("reset"),e("[name=path]").val(r[1]).parents("form").trigger("submit"),a.animate({scrollTop:"0"},"fast")}).addClass("api-url"):o.match(/^https?:\/\/[^.]+\.gravatar\.com\/avatar/)&&(i=e("<img>").attr("src",o).addClass("avatar").add(i))}return i}},v=e("[name=path]"),m=e("[name=query]"),b=e("[name=body]"),y=null,C=function(){var t=e("<div>").addClass("object-builder"),a={},n=[],i={};t.setObject=function(d,r){t.html(""),n=[],i=r,e.each(d,function(i){-1==n.indexOf(i)&&n.push(i),a[i]=d[i]?d[i]:a[i],t.append(e("<div>").addClass("object-property").append(e("<div>").addClass("object-property-key").text(i).bind("click",function(){e(this).next().focus()})).append(e("<div>").addClass("object-property-value").attr("contenteditable",!0).text(a[i]||"").bind("keyup",function(){a[i]=e(this).text(),t.trigger("valuechanged",[i,a[i]])}).bind("focus",function(){q.show().css({left:s.width()+3,top:e(this).parent().offset().top-.5*q.height()+.5*e(this).parent().height()})}).bind("blur",function(){q.hide()})).hover(function(){var t=e(this);y=setTimeout(function(){q.show().css({left:s.width()+3,top:t.offset().top-.5*q.height()+.5*t.height()})},1e3)},function(){clearTimeout(y),q.hide()}))})};var d=function(e){return!e||""==e};return t.getObject=function(){var t={};return e.each(n,function(e,n){d(a[n])||(t[n]=a[n])}),t},t},w=C(),x=C(),j=C();v.parents("div").first().append(w),m.parents("div").first().append(x),b.parents("div").first().append(j);var q=e('<div id="help-bubble"><div></div></div>');q.appendTo(document.body).hide(),i.bind("scroll",function(){q.hide()});var k=e("#reference"),T=k.find("ul"),O=e(".inputs > div").not("#reference");k.append(e("<div><div></div></div>").addClass("throbber")),e.ajax({url:t.api_url+"/"}).done(function(a){var n=wpApiAuth({oauth_consumer_key:t.client_key,oauth_secret:t.client_secret,url:t.api_url,urls:a.authentication.oauth1});window.auth=n,e("#auth a").click(function(t){t.preventDefault(),n.authenticate(function(){e("#auth a").html("Authenticated!")})}),n.authenticated()&&e("#auth a").html("Authenticated!"),k.find(".throbber").remove(),console.log("Response %o",a),e.each(a.routes,function(t){var n,s,i=a.routes[t];if(a.routes[t].namespace&&t!=="/"+a.routes[t].namespace){var d=new RegExp("/"+a.routes[t].namespace+"/([a-zA-Z-_]+).*","g");n=t.replace(d,"$1")}n=n||"wp",s=T.find(".group-"+n),s.is("li")||(s=e("<li><strong>"+n+"</strong><ul></ul></li>").addClass("group-"+n).appendTo(T)),i.supports=i.supports||[],i.methods=i.methods||[],e.each(i.methods,function(a,n){"HEAD"!==n&&s.find("ul").append(e("<li>").append(e('<span class="path-details"></span>').text(n+" "+A(t))).click(function(a){var s=e(a.target),i=s.is("li")?s:s.parents("li").first();if(!i.hasClass("selected")){k.find("li.selected").removeClass("selected"),i.addClass("selected");var d={},r=t.match(/[^<>]+(?=>)/g);r&&r.length&&e.each(r,function(e,t){var a="<"+t+">";d[a]=""}),w.setObject(d,{}),e.each({path:w,query:x,body:j},function(){}),v.val(t).trigger("keyup"),O.find(".raw-toggle").removeClass("on").show().trigger("toggle",[!1]),O.first().hide().find("select").val(n),O.last()["POST"==n?"show":"hide"]()}}))})})}),O.has("input, textarea").each(function(){var t=e(this),a=e('<span class="raw-toggle">Raw</span>').click(function(){e(this).toggleClass("on").trigger("toggle",[e(this).hasClass("on")])});t.append(a),a.bind("toggle",function(e,a){t.find("input, textarea")[a?"show":"hide"](),t.find(".object-builder")[a?"hide":"show"]()}).hide().addClass("on").trigger("toggle",[!0])}),e("form").bind("reset",function(){O.show(),O.find(".raw-toggle").hide().addClass("on").trigger("toggle",[!0]),k.find(".selected").removeClass("selected")});var _=function(t,a){var t=t.slice();return e.each(a,function(e,a){t=t.replace(e,a)}),t},A=function(e){var t=/\(\?P<(\w+?)>.*?\)/g;return e.replace(t,"<$1>")};e('form[action="#request"]').submit(function(n){n.preventDefault();var s={path:e(this.path).parent().siblings().is(".raw-toggle.on")?this.path.value:_(A(this.path.value),w.getObject()),method:this.method.value,data:e(this.body).parent().siblings().is(".raw-toggle.on")?this.body.value:j.getObject(),beforeSend:auth.ajaxBeforeSend};s.query=query=e(this.query).parent().siblings().is(".raw-toggle.on")?this.query.value:x.getObject(),s.url=t.api_url+s.path+"?",request=e("<li></li>").prependTo(a).addClass("loading"),title=e("<h2><small>"+c(s.method)+"</small> "+c(s.path)+"</h2>").appendTo(request);var i;i="object"==typeof s.query?e.param(s.query):s.query,s.url+=i,"string"==typeof i&&""!=i.trim()&&title.append(e("<em>").text(("?"==i[0]?"":"?")+i)),throbber=e("<div><div></div></div>").addClass("throbber").appendTo(request),timer=(new Date).getTime(),console.log("test"),console.log(s),e.ajax(s).done(function(t,a){var n=(new Date).getTime()-timer;request.append(e('<span class="response-meta"></span>').append(e('<span class="response-time"></span>').text(n+" ms ")).append(e('<span class="status-code"></span>').text(a||"?").attr("data-status-code",a||"4xx"))),setTimeout(function(){request.addClass("done").removeClass("loading")},10);var s=e("<div>").addClass("structured").append(t?h(g(t)):e('<span class="empty-response">empty response</span>'));s=s.add(e("<pre>").addClass("pretty").text(f(t,"	"))),s=s.add(e("<pre>").addClass("raw").text(f(t))),e("<div>").addClass("response").append(s.hide()).appendTo(request),e("<ul>").addClass("tabs").append("<li>Structured</li><li>Pretty</li><li>Raw</li>").click(function(t){var a=e(this),n=a.children(),i=n.filter(t.target);n.not(i).removeClass("selected"),i.addClass("selected"),s.hide().eq(n.index(i)).show()}).appendTo(request).children().first().trigger("click"),request.addClass("expanded")})})})});